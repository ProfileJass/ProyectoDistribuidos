{
  "info": {
    "name": "ProyectoDistribuidos - Microservicios",
    "description": "Colecci√≥n completa de endpoints para el sistema de microservicios de usuarios, n√≥minas e incapacidades.\n\nAutores: Jhonatan Sierra, Karen Ruiz, Wilson Soledad",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "12345678"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{JWT_TOKEN}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "BASE_URL",
      "value": "http://localhost",
      "type": "string"
    },
    {
      "key": "JWT_TOKEN",
      "value": "",
      "type": "string"
    },
    {
      "key": "USER_ID",
      "value": "1234567890",
      "type": "string"
    },
    {
      "key": "PAYROLL_ID",
      "value": "1",
      "type": "string"
    },
    {
      "key": "INCAPACITY_ID",
      "value": "1",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. UsersService - Autenticaci√≥n y Usuarios",
      "item": [
        {
          "name": "1.1 Login (Obtener Token JWT)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Guardar el token autom√°ticamente",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('JWT_TOKEN', response.data.token);",
                  "    console.log('‚úÖ Token guardado exitosamente');",
                  "    console.log('Token:', response.data.token);",
                  "    ",
                  "    // Guardar ID del usuario para pruebas",
                  "    pm.collectionVariables.set('ADMIN_ID', response.data.user.id);",
                  "} else {",
                  "    console.log('‚ùå Error en login:', pm.response.json().message);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@example.com\",\n  \"password\": \"mypassword123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/users/login",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "users", "login"]
            },
            "description": "**IMPORTANTE**: Ejecuta este request PRIMERO para obtener el token JWT.\n\nEl token se guarda autom√°ticamente en la variable `JWT_TOKEN` y se usa en todos los dem√°s requests.\n\n**Credenciales por defecto:**\n- Email: admin@example.com\n- Password: mypassword123"
          }
        },
        {
          "name": "1.2 Crear Usuario",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('USER_ID', response.data.id);",
                  "    console.log('‚úÖ Usuario creado con ID:', response.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id\": 1234567890,\n  \"firstName\": \"Juan\",\n  \"lastName\": \"P√©rez\",\n  \"email\": \"juan.perez@example.com\",\n  \"password\": \"SecurePass123\",\n  \"phone\": \"3001234567\",\n  \"role\": \"EMPLOYEE\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/users",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "users"]
            },
            "description": "Crear un nuevo usuario en el sistema.\n\n**Requiere**: Token JWT (Solo Admin)\n\n**Campos obligatorios:**\n- id: N√∫mero de documento (6-12 d√≠gitos)\n- firstName: Nombre\n- lastName: Apellido\n- email: Email √∫nico\n- password: Contrase√±a (m√≠nimo 8 caracteres)\n- phone: Tel√©fono (10 d√≠gitos)\n- role: \"ADMIN\" o \"EMPLOYEE\""
          }
        },
        {
          "name": "1.3 Obtener Todos los Usuarios",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/users",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "users"]
            },
            "description": "Obtener lista de todos los usuarios registrados.\n\n**No requiere autenticaci√≥n**"
          }
        },
        {
          "name": "1.4 Obtener Usuario por ID",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/users/{{USER_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "users", "{{USER_ID}}"]
            },
            "description": "Obtener informaci√≥n detallada de un usuario espec√≠fico.\n\n**No requiere autenticaci√≥n**"
          }
        },
        {
          "name": "1.5 Actualizar Usuario",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Juan Carlos\",\n  \"phone\": \"3109876543\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/users/{{USER_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "users", "{{USER_ID}}"]
            },
            "description": "Actualizar informaci√≥n de un usuario.\n\n**Requiere**: Token JWT (Solo Admin)\n\n**Todos los campos son opcionales**"
          }
        },
        {
          "name": "1.6 Eliminar Usuario",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/users/{{USER_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "users", "{{USER_ID}}"]
            },
            "description": "Eliminar un usuario del sistema.\n\n**Requiere**: Token JWT (Solo Admin)"
          }
        }
      ],
      "description": "Endpoints para gesti√≥n de usuarios y autenticaci√≥n con JWT"
    },
    {
      "name": "2. PayrollService - N√≥minas y Empresas",
      "item": [
        {
          "name": "2.1 Listar Empresas",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/companies",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "companies"]
            },
            "description": "Obtener lista de todas las empresas disponibles.\n\n**Requiere**: Token JWT\n\nEjecuta esto ANTES de crear n√≥minas para conocer los IDs de empresas disponibles."
          }
        },
        {
          "name": "2.2 Crear N√≥mina",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('PAYROLL_ID', response.data.id);",
                  "    console.log('‚úÖ N√≥mina creada con ID:', response.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": {{USER_ID}},\n  \"companyId\": 1,\n  \"status\": \"activo\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/payrolls",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "payrolls"]
            },
            "description": "Crear una n√≥mina para un usuario.\n\n**Requiere**: Token JWT (Solo Admin)\n\n**Campos obligatorios:**\n- userId: ID num√©rico del usuario\n- companyId: ID de la empresa\n- status: \"activo\" o \"retirado\""
          }
        },
        {
          "name": "2.3 Obtener Todas las N√≥minas",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/payrolls",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "payrolls"]
            },
            "description": "Listar todas las n√≥minas del sistema.\n\n**Requiere**: Token JWT (Solo Admin)"
          }
        },
        {
          "name": "2.4 Obtener N√≥mina por ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/payrolls/{{PAYROLL_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "payrolls", "{{PAYROLL_ID}}"]
            },
            "description": "Obtener informaci√≥n de una n√≥mina espec√≠fica.\n\n**Requiere**: Token JWT"
          }
        },
        {
          "name": "2.5 Obtener N√≥minas por Usuario",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/payrolls/user/{{USER_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "payrolls", "user", "{{USER_ID}}"]
            },
            "description": "Obtener todas las n√≥minas de un usuario.\n\n**Requiere**: Token JWT"
          }
        },
        {
          "name": "2.6 Obtener N√≥mina Activa",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/payrolls/user/{{USER_ID}}/active",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "payrolls", "user", "{{USER_ID}}", "active"]
            },
            "description": "Obtener la n√≥mina activa de un usuario.\n\n**Requiere**: Token JWT"
          }
        },
        {
          "name": "2.7 Actualizar N√≥mina",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"retirado\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/payrolls/{{PAYROLL_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "payrolls", "{{PAYROLL_ID}}"]
            },
            "description": "Actualizar informaci√≥n de una n√≥mina.\n\n**Requiere**: Token JWT (Solo Admin)\n\n**Campos opcionales:**\n- status: \"activo\" o \"retirado\""
          }
        },
        {
          "name": "2.8 Eliminar N√≥mina",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/payrolls/{{PAYROLL_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "payrolls", "{{PAYROLL_ID}}"]
            },
            "description": "Eliminar una n√≥mina del sistema.\n\n**Requiere**: Token JWT (Solo Admin)"
          }
        }
      ],
      "description": "Endpoints para gesti√≥n de n√≥minas y empresas"
    },
    {
      "name": "3. IncapacitiesService - Incapacidades",
      "item": [
        {
          "name": "3.1 Crear Incapacidad",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('INCAPACITY_ID', response.data.id);",
                  "    console.log('‚úÖ Incapacidad creada con ID:', response.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id_user\": {{USER_ID}},\n  \"id_payroll\": {{PAYROLL_ID}},\n  \"start_date\": \"2025-11-20\",\n  \"end_date\": \"2025-11-25\",\n  \"type\": \"enfermedad\",\n  \"status\": \"pendiente\",\n  \"observacion\": \"Gripe com√∫n con s√≠ntomas respiratorios\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/incapacities/create",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "incapacities", "create"]
            },
            "description": "Radicar una nueva incapacidad.\n\n**Requiere**: Token JWT\n\n**Campos obligatorios:**\n- id_user: ID del usuario\n- id_payroll: ID de la n√≥mina\n- start_date: Fecha de inicio (YYYY-MM-DD)\n- end_date: Fecha de fin (YYYY-MM-DD)\n- type: \"enfermedad\", \"accidente\", \"maternidad\", \"paternidad\"\n- status: \"pendiente\", \"en tr√°mite\", \"confirmada\", \"negada\"\n- observacion: Descripci√≥n (opcional)"
          }
        },
        {
          "name": "3.2 Obtener Todas las Incapacidades",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/incapacities/getAll",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "incapacities", "getAll"]
            },
            "description": "Listar todas las incapacidades con informaci√≥n completa del usuario, n√≥mina y empresa.\n\n**Requiere**: Token JWT (Solo Admin)"
          }
        },
        {
          "name": "3.3 Obtener Incapacidades por Usuario",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/incapacities/getByUser/{{USER_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "incapacities", "getByUser", "{{USER_ID}}"]
            },
            "description": "Obtener todas las incapacidades de un usuario espec√≠fico.\n\n**Requiere**: Token JWT"
          }
        },
        {
          "name": "3.4 Actualizar Estado de Incapacidad",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"confirmada\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/incapacities/update/{{INCAPACITY_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "incapacities", "update", "{{INCAPACITY_ID}}"]
            },
            "description": "Actualizar el estado de una incapacidad (aprobar o rechazar).\n\n**Requiere**: Token JWT (Solo Admin)\n\n**Valores permitidos:**\n- \"pendiente\"\n- \"en tr√°mite\"\n- \"confirmada\"\n- \"negada\""
          }
        }
      ],
      "description": "Endpoints para gesti√≥n de incapacidades m√©dicas"
    },
    {
      "name": "4. Flujo Completo de Prueba",
      "item": [
        {
          "name": "Paso 1: Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('JWT_TOKEN', response.data.token);",
                  "    console.log('‚úÖ Paso 1 completado: Token obtenido');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@example.com\",\n  \"password\": \"mypassword123\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/users/login",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "users", "login"]
            }
          }
        },
        {
          "name": "Paso 2: Crear Usuario",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('USER_ID', response.data.id);",
                  "    console.log('‚úÖ Paso 2 completado: Usuario creado con ID', response.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id\": 987654321,\n  \"firstName\": \"Mar√≠a\",\n  \"lastName\": \"Gonz√°lez\",\n  \"email\": \"maria.gonzalez@example.com\",\n  \"password\": \"SecurePass456\",\n  \"phone\": \"3209876543\",\n  \"role\": \"EMPLOYEE\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/users",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "users"]
            }
          }
        },
        {
          "name": "Paso 3: Ver Empresas",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('‚úÖ Paso 3 completado: Empresas listadas');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/companies",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "companies"]
            }
          }
        },
        {
          "name": "Paso 4: Crear N√≥mina",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('PAYROLL_ID', response.data.id);",
                  "    console.log('‚úÖ Paso 4 completado: N√≥mina creada con ID', response.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": {{USER_ID}},\n  \"companyId\": 1,\n  \"status\": \"activo\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/payrolls",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "payrolls"]
            }
          }
        },
        {
          "name": "Paso 5: Crear Incapacidad",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('INCAPACITY_ID', response.data.id);",
                  "    console.log('‚úÖ Paso 5 completado: Incapacidad creada con ID', response.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id_user\": {{USER_ID}},\n  \"id_payroll\": {{PAYROLL_ID}},\n  \"start_date\": \"2025-11-20\",\n  \"end_date\": \"2025-11-22\",\n  \"type\": \"enfermedad\",\n  \"status\": \"pendiente\",\n  \"observacion\": \"Resfriado com√∫n\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/incapacities/create",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "incapacities", "create"]
            }
          }
        },
        {
          "name": "Paso 6: Ver Incapacidades",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('‚úÖ Paso 6 completado: Incapacidades listadas');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/incapacities/getAll",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "incapacities", "getAll"]
            }
          }
        },
        {
          "name": "Paso 7: Aprobar Incapacidad",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('‚úÖ Paso 7 completado: Incapacidad aprobada');",
                  "    console.log('üéâ FLUJO COMPLETO FINALIZADO EXITOSAMENTE');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"confirmada\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{BASE_URL}}/api/incapacities/update/{{INCAPACITY_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "incapacities", "update", "{{INCAPACITY_ID}}"]
            }
          }
        }
      ],
      "description": "Ejecuta estos 7 pasos en orden para probar el flujo completo del sistema.\n\nCada paso guarda autom√°ticamente las variables necesarias para los siguientes pasos."
    }
  ]
}

